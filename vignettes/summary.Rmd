---
title: "wundr Package Summary"
author: "John Marin, Matthew Schumwinger, Stefan Zohren"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{wundr Package Summary}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}

    output:
      rmarkdown::html_vignette:
        fig_caption: yes
---

```{r, echo = FALSE}
library(wundr)
```

Package **wundr** provides API interfaces to Personal Weather Station (PWS) data 
maintained by Weather Underground (wunderground.com). Tables of PWS
locations and metadata for user specified geographic areas are constructed.
Robust retrieval of current and historical weather condition data for
selected PWS. Computational tools for spatial analysis, including Kriging
(Gaussian processes) for interpolation, as well as prediction of missing
data and forecasts. Visualization of microclimate data methods including
contextual static and interactive web maps. Additional facility to export data 
to CartoDB's spatial database hosting and webmap publishing platform.

Package **wundr** has the following functionalities:

## Creation of S4-Class Table describing a given region's PWS 

## Subsettable tables based on #1

Graphicly subset PWS.class objects by drawing a poylgon around PWS points
plotted in graphics device. *Note: this is interactive, so must be run run from 
the console.*
```{r, fig.show='hold', warning = FALSE, message = FALSE, eval = FALSE}
my_subset  <-  draw_subset(PWS.Conds.Chicago)
```

## Web retrieval of data and storage in memory

## Visualization of microclimate data

Simple plots of PWS for exploratory analysis:

```{r, fig.show='hold', warning = FALSE, message = FALSE, include = TRUE}
simple_pnts(PWS.Conds.Chicago, "Downtown Chicago PWS")
simple_density(PWS.Conds.Chicago, "Downtown Chicago PWS")
```

Contextual mapping of PWS for exploratory analysis:

```{r, fig.show='hold', warning = FALSE, message = FALSE, include = TRUE}
basemap <- set_basemap(PWS.Conds.Chicago, zoom = 12)
gg_points(PWS.Conds.Chicago, basemap, title = "Downtown Chicago PWS")
```

## Computational tools for spatial analysis

## Web interface with interactive Visuals
For explanitory purposes, the user can also create interactive web maps powered 
by leaflet.js. Here, PWS locations are plotted. Station specific data can 
also be retrieved via interactive pop-ups. (click on a station)

```{r, fig.show='hold'}
webmap_pnts(PWS.Conds.Chicago)
```

Raster images can also be sent to the interactive map. Below, a simple 
density (heatmap) of PWS locations.

```{r}
webmap_raster(PWS.Conds.Chicago)
```

## Integration with the CartoDB platform  
**wundr** also contains functions that interface with the CartoDB SQL API
(http://docs.cartodb.com/cartodb-platform/sql-api/). This allows users to exploit the robust PostGIS spatial database and web publishing services of CartoDB.  

*(note: these code chunks cannot evaluated using knitr, but you can run from console with your own account and key)*

Here, we export Downtown Chicago Weather Underground PWS data to CartoDB's:  

```{r, eval = FALSE}
matt.cdb.key <- "f09ad502b34fa4096a62ea306b4650337d41009c"
matt.cdb.account <- "biglakedata"
pizza <- PWS.Conds.Chicago
r2cdb(matt.cdb.key, matt.cdb.account, pizza)
```
You can view this map here: https://biglakedata.cartodb.com/tables/pizza/map 

This interface goes both ways; we can also import spatial SQL tables into R data frame objects. 

```{r}
# matt_cdb_table <- get_cdb_table("condTest", matt.cdb.account)
head(matt_cdb_table$rows[ , c("cartodb_id", "station_id", "temperature_string", 
                              "dewpoint_string")])# pulled from presaved data file
```

